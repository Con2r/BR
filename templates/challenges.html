{% extends "base.html" %}

{% block title %}–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è - Brainrot Academy{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-code"></i> –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</h1>
        <p class="text-muted">–†–µ—à–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ programming challenges —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–¥–∞. –û—Ç—Ç–∞—á–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ!</p>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-dark text-light">
                <h5 class="card-title mb-0" id="challengeTitle">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ</h5>
            </div>
            <div class="card-body">
                <div id="challengeDescription" class="mb-4">
                    <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ.</p>
                </div>
                
                <div id="codeEditorSection" style="display: none;">
                    <div class="mb-3">
                        <label for="codeEditor" class="form-label">–í–∞—à –∫–æ–¥:</label>
                        <textarea class="form-control font-monospace" id="codeEditor" rows="12" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –∑–¥–µ—Å—å..."></textarea>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" onclick="runTests()">
                            <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
                        </button>
                        <button class="btn btn-outline-secondary" onclick="resetCode()">
                            <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–¥
                        </button>
                    </div>
                </div>

                <div id="testResults" class="mt-4" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-secondary text-light">
                <h5 class="card-title mb-0">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action challenge-item" data-level="1">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">FizzBuzz</h6>
                            <small class="text-muted">–£—Ä–æ–≤–µ–Ω—å 1</small>
                        </div>
                        <p class="mb-1 text-muted small">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞ —É—Å–ª–æ–≤–∏—è</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action challenge-item" data-level="2">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">–ü–∞–ª–∏–Ω–¥—Ä–æ–º</h6>
                            <small class="text-muted">–£—Ä–æ–≤–µ–Ω—å 2</small>
                        </div>
                        <p class="mb-1 text-muted small">–†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action challenge-item" data-level="3">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">–°—É–º–º–∞ —á–∏—Å–µ–ª –≤ —Å—Ç—Ä–æ–∫–µ</h6>
                            <small class="text-muted">–£—Ä–æ–≤–µ–Ω—å 3</small>
                        </div>
                        <p class="mb-1 text-muted small">–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥</p>
                    </a>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header bg-info text-light">
                <h5 class="card-title mb-0"><i class="fas fa-lightbulb"></i> –°–æ–≤–µ—Ç—ã</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">üìù –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–π—Ç–µ —É—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏</li>
                    <li class="mb-2">üß™ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ edge cases</li>
                    <li class="mb-2">üîç –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–ª–∞–¥–∫—É –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤</li>
                    <li class="mb-2">üí° –ù–µ –±–æ–π—Ç–µ—Å—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏</li>
                    <li class="mb-0">ü§ñ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AI-–ø–æ–º–æ—â–Ω–∏–∫ –µ—Å–ª–∏ –∑–∞—Å—Ç—Ä—è–ª–∏</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let currentChallenge = null;
let challengeTemplate = '';

document.querySelectorAll('.challenge-item').forEach(item => {
    item.addEventListener('click', function(e) {
        e.preventDefault();
        const level = this.dataset.level;
        loadChallenge(level);
    });
});

function loadChallenge(level) {
    fetch(`/api/challenge/${level}`)
        .then(response => response.json())
        .then(challenge => {
            currentChallenge = challenge;
            challengeTemplate = challenge.template || '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('challengeTitle').textContent = challenge.title;
            document.getElementById('challengeDescription').innerHTML = `
                <h6>–û–ø–∏—Å–∞–Ω–∏–µ:</h6>
                <p>${challenge.description}</p>
                <div class="alert alert-info">
                    <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ù–∞—á–Ω–∏—Ç–µ —Å —à–∞–±–ª–æ–Ω–∞ –∫–æ–¥–∞ –Ω–∏–∂–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —á–∞—Å—Ç–∏.
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
            document.getElementById('codeEditorSection').style.display = 'block';
            document.getElementById('codeEditor').value = challengeTemplate;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('testResults').style.display = 'none';
        })
        .catch(error => {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–¥–∞–Ω–∏—è');
        });
}

function runTests() {
    if (!currentChallenge) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ');
        return;
    }

    const code = document.getElementById('codeEditor').value;
    if (!code.trim()) {
        alert('–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤');
        return;
    }

    const resultsDiv = document.getElementById('testResults');
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = '<div class="alert alert-info">üîÑ –ó–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç—ã...</div>';

    fetch(`/api/challenge/${currentChallenge.level}/submit`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({code: code})
    })
    .then(response => response.json())
    .then(data => {
        let html = '';
        
        if (data.passed) {
            html = `<div class="alert alert-success">
                <h5>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!</h5>
                <p>${data.message}</p>
            </div>`;
        } else {
            html = `<div class="alert alert-danger">
                <h5>‚ùå –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã</h5>
                <p>${data.message}</p>
            </div>`;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ —Ç–µ—Å—Ç–æ–≤
        if (data.results && data.results.length > 0) {
            html += '<h6>–î–µ—Ç–∞–ª–∏ —Ç–µ—Å—Ç–æ–≤:</h6><div class="table-responsive"><table class="table table-sm table-dark"><thead><tr><th>–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</th><th>–û–∂–∏–¥–∞–ª–æ—Å—å</th><th>–ü–æ–ª—É—á–µ–Ω–æ</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead><tbody>';
            
            data.results.forEach(test => {
                const status = test.passed ? 
                    '<span class="badge bg-success">‚úì</span>' : 
                    '<span class="badge bg-danger">‚úó</span>';
                
                const expected = test.expected !== undefined ? JSON.stringify(test.expected) : '-';
                const actual = test.actual !== undefined ? JSON.stringify(test.actual) : (test.error || '-');
                
                html += `<tr>
                    <td><code>${JSON.stringify(test.input)}</code></td>
                    <td><code>${expected}</code></td>
                    <td><code>${actual}</code></td>
                    <td>${status}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
        }

        resultsDiv.innerHTML = html;
    })
    .catch(error => {
        resultsDiv.innerHTML = '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤</div>';
    });
}

function resetCode() {
    if (currentChallenge && challengeTemplate) {
        document.getElementById('codeEditor').value = challengeTemplate;
    }
}
</script>

<style>
.code-editor {
    font-family: 'Courier New', monospace;
    font-size: 14px;
}
.challenge-item:hover {
    background-color: #2c3034 !important;
}
</style>
{% endblock %}